<section class="section">
  <header class="section__head">
    <div class="list-inline">
      <span class="pill">Report</span>
      <span class="pill pill--sunrise">Gantt chart</span>
    </div>
    <h1 class="section__title"><%= @project.name %> timeline</h1>
    <p class="section__lead">Visualizes activity schedule inspired by Primavera/MS Project.</p>
    <div class="hero__cta">
      <%= link_to "Back to project", project_path(@project), class: "btn btn--ghost" %>
      <%= link_to "Download PDF", gantt_project_path(@project, format: :pdf), class: "btn btn--primary" %>
    </div>
  </header>

  <% if @activities.any? %>
    <% activities_payload = @activities.map do |activity|
        {
          id: activity.id,
          title: activity.title,
          status: activity_status(activity).to_s,
          start_on: activity.start_on&.iso8601,
          due_on: activity.due_on&.iso8601,
          start_label: activity.start_on&.to_fs(:long) || "N/A",
          due_label: activity.due_on&.to_fs(:long) || "N/A",
          assignee: activity.assignee&.display_name || "Unassigned",
          discipline: activity.discipline&.name,
          zone: activity.zone&.name,
          duration_days: activity.duration_days,
          url: activity_path(activity)
        }
      end %>

    <div
      class="gantt-wrapper"
      data-controller="gantt"
      data-gantt-target="wrapper"
      data-gantt-start-value="<%= @timeline_start.iso8601 %>"
      data-gantt-end-value="<%= @timeline_end.iso8601 %>"
      data-gantt-activities-value="<%= activities_payload.to_json %>"
      data-gantt-scale-value="auto"
      data-gantt-project-id-value="<%= @project.id %>"
    >
      <div class="gantt__toolbar">
        <span class="gantt__toolbar-label">Scale:</span>
        <button type="button" class="gantt__toolbar-button" data-gantt-target="scaleButton" data-gantt-scale-step="auto" data-action="click->gantt#setScale">Auto</button>
        <button type="button" class="gantt__toolbar-button" data-gantt-target="scaleButton" data-gantt-scale-step="day" data-action="click->gantt#setScale">Daily</button>
        <button type="button" class="gantt__toolbar-button" data-gantt-target="scaleButton" data-gantt-scale-step="week" data-action="click->gantt#setScale">Weekly</button>
        <button type="button" class="gantt__toolbar-button" data-gantt-target="scaleButton" data-gantt-scale-step="month" data-action="click->gantt#setScale">Monthly</button>
        <div class="gantt__toolbar-spacer"></div>
        <button type="button"
                class="gantt__toolbar-button gantt__toolbar-button--ghost"
                data-action="click->gantt#toggleFullscreen"
                data-gantt-target="fullscreenButton"
                aria-pressed="false">
          Full screen
        </button>
      </div>
      <div class="gantt" data-gantt-target="canvas"></div>
    </div>
    <noscript>
      <p class="meta meta--note">Enable JavaScript to view the interactive Gantt chart.</p>
    </noscript>
  <% else %>
    <div class="empty-state">
      <p>No activities yet. Once you add some, their schedule will appear here.</p>
      <%= link_to "Create an activity", new_project_activity_path(@project), class: "btn btn--primary" %>
    </div>
  <% end %>
</section>
