<section class="section">
  <header class="section__head">
    <div class="section__headline">
      <h1 class="section__title">Projects</h1>
      <%= link_to new_project_path, class: "btn btn--primary btn--large" do %>
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 4v12m-6-6h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        New Project
      <% end %>
    </div>
    <p class="section__lead">
      <%= pluralize(@projects.count, "active project") %> Â· Manage your work in organized spaces
    </p>
  </header>

  <!-- Filter Bar -->
  <div class="filter-bar">
    <button class="filter-bar__button">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
        <path d="M2 4h12M4 8h8M6 12h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
      Filter
    </button>
    <button class="filter-bar__button">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
        <path d="M4 6l4-4 4 4M4 10l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
      Sort
    </button>
    <div class="filter-bar__spacer"></div>
    <span class="meta"><%= @projects.count %> projects</span>
  </div>

  <% if @projects.any? %>
    <div class="projects-grid">
      <% @projects.each do |project| %>
        <article class="project-card">
          <div class="project-card__header">
            <div>
              <h3 class="project-card__title">
                <%= link_to project.name, project %>
              </h3>
              <p class="project-card__description">
                <%= truncate(project.description.to_s.presence || "No description", length: 120) %>
              </p>
            </div>
            <% if project.owner_id == current_user.id %>
              <span class="status-badge status-badge--purple">Owner</span>
            <% else %>
              <span class="status-badge status-badge--blue">Member</span>
            <% end %>
          </div>

          <div class="project-card__meta">
            <div class="project-card__meta-item">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M8 14A6 6 0 108 2a6 6 0 000 12z" stroke="currentColor" stroke-width="1.5"/>
                <path d="M8 4v4l2 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              Updated <%= time_ago_in_words(project.updated_at) %> ago
            </div>
            <div class="project-card__meta-item">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M13 14v-1.333A2.667 2.667 0 0010.333 10H5.667A2.667 2.667 0 003 12.667V14M8 7.333A2.667 2.667 0 108 2a2.667 2.667 0 000 5.333z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              <%= project.project_memberships.count + 1 %> members
            </div>
          </div>

          <%
            total_activities = project.activities.count
            done_activities = project.activities.where(is_done: true).count
            progress_pct = total_activities > 0 ? (done_activities.to_f / total_activities * 100).round : 0
          %>

          <div class="project-card__progress">
            <div class="project-card__progress-label">
              <span><%= done_activities %> / <%= total_activities %> activities completed</span>
              <span class="project-card__progress-percent"><%= progress_pct %>%</span>
            </div>
            <div class="project-card__progress-bar">
              <div class="project-card__progress-fill" style="width: <%= progress_pct %>%"></div>
            </div>
          </div>

          <div class="project-card__actions">
            <%= link_to "Open Project", project, class: "btn btn--primary btn--sm" %>
            <% if project.owner_id == current_user.id %>
              <%= link_to "Edit", edit_project_path(project), class: "btn btn--ghost btn--sm" %>
            <% end %>
          </div>
        </article>
      <% end %>
    </div>
  <% else %>
    <div class="empty-state">
      <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
        <path d="M12 28v16a4 4 0 004 4h32a4 4 0 004-4V24a4 4 0 00-4-4H28l-4-4H16a4 4 0 00-4 4z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <p>No projects yet. Create your first project to get started.</p>
      <%= link_to "Create Your First Project", new_project_path, class: "btn btn--primary" %>
    </div>
  <% end %>
</section>
