<!DOCTYPE html>
<html>
  <head>
    <title>Campy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>
  <body class="app" <%= 'data-theme="dark"' if current_theme == "dark" %>>
    <header class="site-header">
      <div class="site-header__inner">
        <%= link_to (user_signed_in? ? authenticated_root_path : root_path), class: "brand" do %>
          <span class="brand__badge">C</span>
          <span>Campy</span>
        <% end %>
        <nav class="nav">
          <% if user_signed_in? %>
            <%= link_to "Dashboard", authenticated_root_path, class: nav_link_class(authenticated_root_path) %>
            <%= link_to "Projects", projects_path, class: nav_link_class(projects_path) %>
            <%= link_to "My activities", my_activities_path, class: nav_link_class(my_activities_path) %>
            <%= link_to "Calendar", calendar_path, class: nav_link_class(calendar_path) %>
            <%= link_to "Messages", conversations_path, class: nav_link_class(conversations_path) %>

            <!-- Notifications Bell -->
            <div class="notification-bell-wrapper" data-controller="notifications">
              <button type="button" class="notification-bell" data-action="click->notifications#toggle">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15 6.66669C15 5.34061 14.4732 4.06883 13.5355 3.13115C12.5979 2.19347 11.3261 1.66669 10 1.66669C8.67392 1.66669 7.40215 2.19347 6.46447 3.13115C5.52678 4.06883 5 5.34061 5 6.66669C5 12.5 2.5 14.1667 2.5 14.1667H17.5C17.5 14.1667 15 12.5 15 6.66669Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M11.4417 17.5C11.2952 17.7526 11.0849 17.9622 10.8319 18.1079C10.5788 18.2537 10.292 18.3304 10 18.3304C9.70802 18.3304 9.42119 18.2537 9.16816 18.1079C8.91514 17.9622 8.70484 17.7526 8.55835 17.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span data-notifications-target="badge" class="notification-badge" style="display: none;">0</span>
              </button>

              <!-- Dropdown Container -->
              <div class="notification-dropdown-container" data-notifications-target="dropdown"></div>
            </div>

            <div class="nav__profile">
              <button type="button" class="nav__avatar-button" aria-haspopup="true" aria-label="Account menu">
                <%= avatar_for(current_user) %>
              </button>
              <div class="nav__profile-menu" role="menu">
                <%= link_to "Settings", settings_path, class: "nav__profile-link", role: "menuitem" %>
                <%= link_to "Sign out", destroy_user_session_path, data: { turbo_method: :delete }, class: "nav__profile-link nav__profile-link--danger", role: "menuitem" %>
              </div>
            </div>
          <% else %>
            <%= link_to "Sign in", new_user_session_path, class: "nav-link" %>
            <%= link_to "Start your free trial", new_user_registration_path, class: "btn btn--primary" %>
          <% end %>
        </nav>
      </div>
    </header>

    <main class="page main-content">
      <%= render "shared/flash" %>
      <%= yield %>
    </main>

    <footer class="site-footer">
      <small>Campy helps teams stay on track. Â© <%= Time.current.year %></small>
    </footer>
  </body>
</html>
