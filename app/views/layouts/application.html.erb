<!DOCTYPE html>
<html>
  <head>
    <title>Campy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>
  <body class="app app--sidebar-layout" <%= 'data-theme="dark"' if current_theme == "dark" %>>
    <% if user_signed_in? %>
      <!-- Left Sidebar -->
      <aside class="sidebar">
        <div class="sidebar__header">
          <%= link_to authenticated_root_path, class: "sidebar__brand" do %>
            <span class="sidebar__brand-badge">C</span>
            <span class="sidebar__brand-text">Campy</span>
          <% end %>
        </div>

        <nav class="sidebar__nav">
          <span class="sidebar__nav-label">Menu</span>

          <%= link_to authenticated_root_path, class: "sidebar__nav-item #{current_page?(authenticated_root_path) ? 'sidebar__nav-item--active' : ''}" do %>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M3 7.5L10 2.5L17 7.5V16.5C17 17.0523 16.5523 17.5 16 17.5H4C3.44772 17.5 3 17.0523 3 16.5V7.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Dashboard</span>
          <% end %>

          <%= link_to projects_path, class: "sidebar__nav-item #{current_page?(projects_path) ? 'sidebar__nav-item--active' : ''}" do %>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M3 7v10a2 2 0 002 2h10a2 2 0 002-2V9a2 2 0 00-2-2h-4l-2-2H5a2 2 0 00-2 2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Projects</span>
          <% end %>

          <%= link_to my_activities_path, class: "sidebar__nav-item #{current_page?(my_activities_path) ? 'sidebar__nav-item--active' : ''}" do %>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M9 5H7a2 2 0 00-2 2v8a2 2 0 002 2h6a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h0a2 2 0 002-2M9 5a2 2 0 012-2h0a2 2 0 012 2m-6 9l2 2 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>My Activities</span>
          <% end %>

          <%= link_to calendar_path, class: "sidebar__nav-item #{current_page?(calendar_path) ? 'sidebar__nav-item--active' : ''}" do %>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M6 2v2m8-2v2M3 8h14M5 4h10a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V6a2 2 0 012-2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Calendar</span>
          <% end %>

          <%= link_to conversations_path, class: "sidebar__nav-item #{current_page?(conversations_path) ? 'sidebar__nav-item--active' : ''}" do %>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M17 10c0 3.866-3.582 7-8 7a9.06 9.06 0 01-2.347-.306c-.584.296-1.925.864-4.181 1.234-.293.048-.586-.072-.771-.31a.9.9 0 01-.155-.917c.357-.933.818-1.927.818-2.701C2.122 12.626 1 11.37 1 10c0-3.866 3.582-7 8-7s8 3.134 8 7z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Messages</span>
            <% if false %><span class="sidebar__badge">3</span><% end %>
          <% end %>

          <%= link_to disciplines_path, class: "sidebar__nav-item" do %>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M7 17a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v8a4 4 0 01-4 4zm0 0h8a2 2 0 002-2v-3a2 2 0 00-2-2h-2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Disciplines</span>
          <% end %>

          <%= link_to zones_path, class: "sidebar__nav-item" do %>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M9 16l-5-3V7l5-3m0 12l5-3m-5 3V10m5 3l5-3V7l-5-3M9 4L4 7m10-3L9 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Zones</span>
          <% end %>
        </nav>

        <div class="sidebar__footer">
          <%= link_to settings_path, class: "sidebar__nav-item" do %>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M16.395 12.5a1.375 1.375 0 00.275 1.515l.05.05a1.667 1.667 0 11-2.357 2.358l-.05-.05a1.375 1.375 0 00-1.516-.275 1.375 1.375 0 00-.834 1.258v.142a1.667 1.667 0 01-3.333 0v-.075a1.375 1.375 0 00-.9-1.258 1.375 1.375 0 00-1.516.275l-.05.05a1.667 1.667 0 11-2.357-2.358l.05-.05a1.375 1.375 0 00.275-1.516 1.375 1.375 0 00-1.258-.833H2.5a1.667 1.667 0 110-3.334h.075a1.375 1.375 0 001.258-.9 1.375 1.375 0 00-.275-1.516l-.05-.05a1.667 1.667 0 112.358-2.357l.05.05a1.375 1.375 0 001.515.275h.067a1.375 1.375 0 00.833-1.258v-.142a1.667 1.667 0 013.334 0v.075a1.375 1.375 0 00.833 1.258 1.375 1.375 0 001.516-.275l.05-.05a1.667 1.667 0 112.357 2.358l-.05.05a1.375 1.375 0 00-.275 1.515v.067a1.375 1.375 0 001.258.833h.142a1.667 1.667 0 010 3.334h-.075a1.375 1.375 0 00-1.258.833z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Settings</span>
          <% end %>

          <%= link_to destroy_user_session_path, data: { turbo_method: :delete }, class: "sidebar__nav-item" do %>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M14 15l5-5-5-5M19 10H9m0-8a8 8 0 100 16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Sign Out</span>
          <% end %>
        </div>
      </aside>

      <!-- Main Content Area -->
      <div class="main-wrapper">
        <!-- Top Bar -->
        <header class="topbar">
          <div class="topbar__search">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M9 17A8 8 0 109 1a8 8 0 000 16zM17 17l-4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <input type="text" placeholder="Search or type a command" class="topbar__search-input">
            <kbd class="topbar__shortcut">⌘ F</kbd>
          </div>

          <div class="topbar__actions">
            <!-- Notifications Bell -->
            <div class="notification-bell-wrapper" data-controller="notifications">
              <button type="button" class="notification-bell" data-action="click->notifications#toggle">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M15 6.66669C15 5.34061 14.4732 4.06883 13.5355 3.13115C12.5979 2.19347 11.3261 1.66669 10 1.66669C8.67392 1.66669 7.40215 2.19347 6.46447 3.13115C5.52678 4.06883 5 5.34061 5 6.66669C5 12.5 2.5 14.1667 2.5 14.1667H17.5C17.5 14.1667 15 12.5 15 6.66669Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M11.4417 17.5C11.2952 17.7526 11.0849 17.9622 10.8319 18.1079C10.5788 18.2537 10.292 18.3304 10 18.3304C9.70802 18.3304 9.42119 18.2537 9.16816 18.1079C8.91514 17.9622 8.70484 17.7526 8.55835 17.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span data-notifications-target="badge" class="notification-badge" style="display: none;">0</span>
              </button>
              <div class="notification-dropdown-container" data-notifications-target="dropdown"></div>
            </div>

            <div class="topbar__user">
              <%= avatar_for(current_user, size: 32) %>
              <span class="topbar__user-name"><%= current_user.display_name %></span>
            </div>
          </div>
        </header>

        <!-- Page Content -->
        <main class="page-content">
          <%= render "shared/flash" %>
          <%= yield %>
        </main>
      </div>
    <% else %>
      <!-- Guest Layout (no sidebar) -->
      <header class="site-header">
        <div class="site-header__inner">
          <%= link_to root_path, class: "brand" do %>
            <span class="brand__badge">C</span>
            <span>Campy</span>
          <% end %>
          <nav class="nav">
            <%= link_to "Sign in", new_user_session_path, class: "nav-link" %>
            <%= link_to "Start your free trial", new_user_registration_path, class: "btn btn--primary" %>
          </nav>
        </div>
      </header>

      <main class="page main-content">
        <%= render "shared/flash" %>
        <%= yield %>
      </main>

      <footer class="site-footer">
        <small>Campy helps teams stay on track. © <%= Time.current.year %></small>
      </footer>
    <% end %>
  </body>
</html>
